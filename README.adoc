== NOAA implementation of the pairwise method of Menne and Williams (2009), v52d layout

This repository is the v52d code/data layout aligned to a modernized project structure:

- `phav52d/` for source, scripts, and documentation
- `data/` for benchmark and real-world inputs/outputs

For detailed operational notes, see `phav52d/readme.quick_start`.

=== Inferred documentation

From `phav52d/scripts/combo_runs/case7_bench.sh`, the benchmark script accepts:

. `$1`: UCP routine stem, e.g. `UCPM24aM21fC6bL1Si6cR5aH1`

The script internally runs `${1}.FAST.MLY.21_21` against the case7 benchmark data.

=== Building and Running

Build with docker:

[source,shell]
----
$ docker build --tag noaa-pha:v52d .
----

The image compiles:

- PHA v52d (`UCPM24aM21fC6bL1Si6cR5aH1.FAST.MLY.21_21`)

`phav52d/documentation/readme.compiles` (distance/correlation/fillin helper utilities) is not run in Docker build because those legacy sources require a `g77`-compatible compiler.

Run the benchmark in an isolated run directory (so reference files are not overwritten):

[source,shell]
----
$ RUN_DIR="data/benchmark/case7-run-$(date +%Y%m%d%H%M%S)" && \
  mkdir -p "$RUN_DIR/monthly" "$RUN_DIR/output" && \
  cp -a data/benchmark/case7/corr "$RUN_DIR/" && \
  cp -a data/benchmark/case7/monthly/raw "$RUN_DIR/monthly/" && \
  docker run --rm -ti \
    -v "$(pwd)/$RUN_DIR:/home/cwilliam/data/benchmark/case7" \
    noaa-pha:v52d \
    sh -c 'export USHCNBASE=$HOME && ./phav52d/scripts/combo_runs/case7_bench.sh UCPM24aM21fC6bL1Si6cR5aH1'
----

Compare generated outputs to the checked-in reference:

[source,shell]
----
$ diff -ru data/benchmark/case7/monthly/WMs.52d "$RUN_DIR/monthly/WMs.52d"
$ diff -u -w -B data/benchmark/case7/output/case7_bench.00_09.log "$RUN_DIR"/output/case7_bench.*.log
----
